const translations = {
  en: {
    "login.userLogin": "User Login",
    "login.inputUsername": "Enter username",
    "login.inputPassword": "Enter password",
    "login.loginBtn": "Login",
    "login.noAccount": "No account yet?",
    "login.goRegister": "Register",
    "register.userRegister": "User Register",
    "register.inputUsername": "Enter username",
    "register.inputPassword": "Enter password",
    "register.registerBtn": "Register",
    "register.alreadyHaveAccount": "Already have an account?",
    "register.goLogin": "Login",
    "msg.registerSuccess": "Register success",
    "msg.userExists": "Username already exists",
    "msg.noteDecrypted": "Note decrypted!",
    "msg.pwdWrong": "Password wrong",
    "msg.noteNotEncrypted": "This note is not encrypted.",
    "msg.noteEncrypted": "This note is already encrypted.",
    "msg.pwdNotMatch": "Passwords do not match. Operation canceled",
    "msg.pwdNotEmpty": "Password cannot be empty. Operation canceled",
    "msg.noteAlreadyEncrypted": "This note is already encrypted. Please decrypt it first",
    "msg.selectNoteFirst": "Please select a note first",
    "msg.linkCopied": "Link copied",
    "msg.logoutSuccess": "Logged out",
    "msg.fillInfo": "Please fill in all information",
    "msg.wrongInfo": "Wrong username or password",
    "msg.loginSuccess": "Login success",
    "msg.loginFirst": "Please login first",
    "state.logoutBtn": "Logout",
    "state.welcome": " Welcome,",
    "state.logout": "Not logged in",
    "folder.all": "All",
    "folder.uncategorized": "Uncategorized",
    "folder.trash": "Trash",
    "title.noteCategory": "Note Categories",
    "btn.addFolder": "Add Folder",
    "btn.addNote": "Add Note",
    "btn.addNoteSymbol": "+",
    "placeholder.search": "Search notes...",
    "text.noteCount": "0 notes",
    "btn.sort": "Sort ▾",
    "sort.createTimeAsc": "Create Time (ASC)",
    "sort.createTimeDesc": "Create Time (DESC)",
    "sort.lastModifiedAsc": "Modified Time (ASC)",
    "sort.lastModifiedDesc": "Modified Time (DESC)",
    "sort.titleAsc": "Title (ASC)",
    "sort.titleDesc": "Title (DESC)",
    "label.createTimePrefix": "Created: ",
    "label.lastModifiedPrefix": "Last Modified: ",
    "btn.encrypt": "🔒 Encrypt",
    "btn.decrypt": "🔑 Decrypt",
    "text.markdownEdit": "Markdown Edit",
    "text.richTextEdit": "Rich Text",
    "btn.export": "Export ▾",
    "export.pdf": "Export PDF",
    "export.markdown": "Export Markdown",
    "export.pdfLink": "Copy PDF Link",
    "export.markdownLink": "Copy Markdown Link",
    "modal.enterPwd": "Enter Password",
    "modal.setPwd": "Set Password",
    "modal.decrypt": "Decrypt",
    "btn.confirm": "Confirm",
    "btn.cancel": "Cancel",
    "placeholder.inputPwd": "Enter password",
    "placeholder.confirmPwd": "Confirm password",

    "label.chooseTheme": "Choose Theme:",
    "option.blue": "Blue",
    "option.dark": "Dark",
    "option.yellow": "Yellow",
    "option.purple": "Purple",
    "option.green": "Green",
  },

  zh: {
    "login.userLogin": "用户登录",
    "login.inputUsername": "请输入用户名",
    "login.inputPassword": "请输入密码",
    "login.loginBtn": "登录",
    "login.noAccount": "还没有账号？",
    "login.goRegister": "去注册",
    "register.userRegister": "用户注册",
    "register.inputUsername": "请输入用户名",
    "register.inputPassword": "请输入密码",
    "register.registerBtn": "注册",
    "register.alreadyHaveAccount": "已有账号？",
    "register.goLogin": "去登录",
    "msg.registerSuccess": "注册成功",
    "msg.userExists": "用户名已存在",
    "msg.noteDecrypted": "笔记已解密！",
    "msg.pwdWrong": "密码错误！",
    "msg.noteNotEncrypted": "笔记未加密！",
    "msg.noteEncrypted": "笔记已加密！",
    "msg.pwdNotMatch": "两次密码不一致，加密操作取消",
    "msg.pwdNotEmpty": "密码不能为空，加密操作取消",
    "msg.noteAlreadyEncrypted": "当前笔记已加密。请解密后再操作",
    "msg.selectNoteFirst": "请先选中一条笔记再进行操作",
    "msg.linkCopied": "链接已生成，已复制到剪切板",
    "msg.logoutSuccess": "已退出登录",
    "msg.fillInfo": "请填写完整信息",
    "msg.wrongInfo": "用户名或密码错误",
    "msg.loginSuccess": "登录成功",
    "msg.loginFirst": "请先登录",
    "state.logoutBtn": "退出登录",
    "state.welcome": " 欢迎，",
    "state.logout": "尚未登录",
    "folder.all": "全部笔记",
    "folder.uncategorized": "未分类",
    "folder.trash": "回收站",
    "title.noteCategory": "笔记分类",
    "btn.addFolder": "添加分类",
    "btn.addNote": "添加笔记",
    "btn.addNoteSymbol": "+",
    "placeholder.search": "搜索笔记...",
    "text.noteCount": "共0条笔记",
    "btn.sort": "排序 ▾",
    "sort.createTimeAsc": "按创建时间 (正序)",
    "sort.createTimeDesc": "按创建时间 (倒序)",
    "sort.lastModifiedAsc": "按修改时间 (正序)",
    "sort.lastModifiedDesc": "按修改时间 (倒序)",
    "sort.titleAsc": "按标题 (正序)",
    "sort.titleDesc": "按标题 (倒序)",
    "label.createTimePrefix": "创建时间：",
    "label.lastModifiedPrefix": "最后修改：",
    "btn.encrypt": "🔒 加密",
    "btn.decrypt": "🔑 解密",
    "text.markdownEdit": "Markdown编辑",
    "text.richTextEdit": "富文本编辑",
    "btn.export": "导出 ▾",
    "export.pdf": "导出PDF",
    "export.markdown": "导出Markdown",
    "export.pdfLink": "复制PDF链接",
    "export.markdownLink": "复制Markdown链接",
    "modal.enterPwd": "请输入笔记密码",
    "modal.setPwd": "设置密码",
    "modal.decrypt": "解密操作",
    "btn.confirm": "确认",
    "btn.cancel": "取消",
    "placeholder.inputPwd": "请输入密码",
    "placeholder.confirmPwd": "请再次输入密码",

    "label.chooseTheme": "选择主题:",
    "option.blue": "清新蓝",
    "option.dark": "暗黑模式",
    "option.yellow": "明媚黄",
    "option.purple": "浪漫紫",
    "option.green": "清爽绿",
  },

  // ===== 日语（ja） =====
  ja: {
    "login.userLogin": "ユーザーログイン",
    "login.inputUsername": "ユーザー名を入力",
    "login.inputPassword": "パスワードを入力",
    "login.loginBtn": "ログイン",
    "login.noAccount": "アカウントをお持ちでないですか？",
    "login.goRegister": "登録",
    "register.userRegister": "ユーザー登録",
    "register.inputUsername": "ユーザー名を入力",
    "register.inputPassword": "パスワードを入力",
    "register.registerBtn": "登録",
    "register.alreadyHaveAccount": "すでにアカウントをお持ちですか？",
    "register.goLogin": "ログイン",
    "msg.registerSuccess": "登録成功",
    "msg.userExists": "ユーザー名はすでに存在します",
    "msg.noteDecrypted": "ノートが復号化されました！",
    "msg.pwdWrong": "パスワードが間違っています",
    "msg.noteNotEncrypted": "このノートはすでに暗号化されていません。",
    "msg.noteEncrypted": "このノートはすでに",
    "msg.pwdNotMatch": "パスワードが一致しません。操作をキャンセルしました",
    "msg.pwdNotEmpty": "パスワードを入力してください",
    "msg.noteAlreadyEncrypted": "このノートはすでに暗号化されています。操作を行う前に復号化してください",
    "msg.selectNoteFirst": "ノートを選択してください",
    "msg.linkCopied": "リンクが生成され、クリップボードにコピーされました",
    "msg.logoutSuccess": "ログアウトしました",
    "msg.fillInfo": "すべての情報を入力してください",
    "msg.wrongInfo": "ユーザー名またはパスワードが間違っています",
    "msg.loginSuccess": "ログイン成功",
    "msg.loginFirst": "ログインしてください",
    "state.logoutBtn": "ログアウト",
    "state.welcome": " ようこそ、",
    "state.logout": "ログインしていません",
    "folder.all": "すべてのノート",
    "folder.uncategorized": "未分類",
    "folder.trash": "ゴミ箱",
    "title.noteCategory": "ノートカテゴリ",
    "btn.addFolder": "フォルダーを追加",
    "btn.addNote": "ノートを追加",
    "btn.addNoteSymbol": "+",
    "placeholder.search": "ノートを検索...",
    "text.noteCount": "0 件のノート",
    "btn.sort": "並び替え ▾",
    "sort.createTimeAsc": "作成日 (昇順)",
    "sort.createTimeDesc": "作成日 (降順)",
    "sort.lastModifiedAsc": "更新日 (昇順)",
    "sort.lastModifiedDesc": "更新日 (降順)",
    "sort.titleAsc": "タイトル (昇順)",
    "sort.titleDesc": "タイトル (降順)",
    "label.createTimePrefix": "作成日時：",
    "label.lastModifiedPrefix": "最終更新：",
    "btn.encrypt": "🔒 暗号化",
    "btn.decrypt": "🔑 復号",
    "text.markdownEdit": "Markdown編集",
    "text.richTextEdit": "リッチテキスト",
    "btn.export": "エクスポート ▾",
    "export.pdf": "PDFとしてエクスポート",
    "export.markdown": "Markdownとしてエクスポート",
    "export.pdfLink": "PDFリンクをコピー",
    "export.markdownLink": "Markdownリンクをコピー",
    "modal.enterPwd": "ノートのパスワードを入力してください",
    "modal.setPwd": "パスワードを設定",
    "modal.decrypt": "ノートの復号",
    "btn.confirm": "確認",
    "btn.cancel": "キャンセル",
    "placeholder.inputPwd": "パスワードを入力",
    "placeholder.confirmPwd": "パスワードを再入力",

    "label.chooseTheme": "テーマを選択：",
    "option.blue": "ブルー",
    "option.dark": "ダーク",
    "option.yellow": "イエロー",
    "option.purple": "パープル",
    "option.green": "グリーン",
  },

  // ===== 法语（fr） =====
  fr: {
    "login.userLogin": "Connexion utilisateur",
    "login.inputUsername": "Entrez votre nom d'utilisateur",
    "login.inputPassword": "Entrez votre mot de passe",
    "login.loginBtn": "Connexion",
    "login.noAccount": "Pas encore de compte ?",
    "login.goRegister": "S'inscrire",
    "register.userRegister": "Inscription utilisateur",
    "register.inputUsername": "Entrez votre nom d'utilisateur",
    "register.inputPassword": "Entrez votre mot de passe",
    "register.registerBtn": "S'inscrire",
    "register.alreadyHaveAccount": "Déjà un compte ?",
    "register.goLogin": "Se connecter ",
    "msg.registerSuccess": "Inscription réussie",
    "msg.userExists": "Nom d'utilisateur déjà existant",
    "msg.noteDecrypted": "Note déchiffrée!",
    "msg.pwdWrong": "Mot de passe incorrect",
    "msg.noteNotEncrypted": "Cette note n'est pas chiffrée.",
    "msg.noteEncrypted": "Cette note est déjà chiffrée.",
    "msg.pwdNotMatch": "Les mots de passe ne correspondent pas. Opération annulée",
    "msg.pwdNotEmpty": "Le mot de passe ne peut pas être vide. Opération annulée",
    "msg.noteAlreadyEncrypted": "Cette note est déjà chiffrée. Veuillez la déchiffrer d'abord",
    "msg.selectNoteFirst": "Veuillez d'abord sélectionner une note",
    "msg.linkCopied": "Lien copié",
    "msg.logoutSuccess": "Déconnecté",
    "msg.fillInfo": "Veuillez remplir toutes les informations",
    "msg.wrongInfo": "Nom d'utilisateur ou mot de passe incorrect",
    "msg.loginSuccess": "Connexion réussie",
    "msg.loginFirst": "Veuillez vous connecter d'abord",
    "state.logoutBtn": "Déconnexion",
    "state.welcome": " Bienvenue,",
    "state.logout": "Déconnecté",
    "folder.all": "Toutes les notes",
    "folder.uncategorized": "Non classé",
    "folder.trash": "Corbeille",
    "title.noteCategory": "Catégories de notes",
    "btn.addFolder": "Ajouter un dossier",
    "btn.addNote": "Ajouter une note",
    "btn.addNoteSymbol": "+",
    "placeholder.search": "Rechercher des notes...",
    "text.noteCount": "0 notes",
    "btn.sort": "Trier ▾",
    "sort.createTimeAsc": "Date de création (ASC)",
    "sort.createTimeDesc": "Date de création (DESC)",
    "sort.lastModifiedAsc": "Date de modification (ASC)",
    "sort.lastModifiedDesc": "Date de modification (DESC)",
    "sort.titleAsc": "Titre (ASC)",
    "sort.titleDesc": "Titre (DESC)",
    "label.createTimePrefix": "Créé : ",
    "label.lastModifiedPrefix": "Dernière modification : ",
    "btn.encrypt": "🔒 Chiffrer",
    "btn.decrypt": "🔑 Déchiffrer",
    "text.markdownEdit": "Édition Markdown",
    "text.richTextEdit": "Édition Rich Text",
    "btn.export": "Exporter ▾",
    "export.pdf": "Exporter PDF",
    "export.markdown": "Exporter Markdown",
    "export.pdfLink": "Copier le lien PDF",
    "export.markdownLink": "Copier le lien Markdown",
    "modal.enterPwd": "Entrez le mot de passe",
    "modal.setPwd": "Définir le mot de passe",
    "modal.decrypt": "Déchiffrer",
    "btn.confirm": "Confirmer",
    "btn.cancel": "Annuler",
    "placeholder.inputPwd": "Entrez le mot de passe",
    "placeholder.confirmPwd": "Confirmez le mot de passe",

    "label.chooseTheme": "Choisir le thème :",
    "option.blue": "Bleu",
    "option.dark": "Sombre",
    "option.yellow": "Jaune",
    "option.purple": "Violet",
    "option.green": "Vert",
  },
};

function applyLanguage(lang) {
  const notesLength = document.querySelectorAll(".note-item").length;
  console.log("notesLength", notesLength);
  const langPack = translations[lang] || translations["zh"];

  document.querySelectorAll("[data-i18n-key]").forEach((el) => {
    const key = el.getAttribute("data-i18n-key");
    if (langPack[key]) {
      el.textContent = langPack[key];
    }
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    if (langPack[key]) {
      el.placeholder = langPack[key];
    }
  });

  const noteCountEl = document.querySelector(".note-count");
  if (noteCountEl) {
    const countText = noteCountEl.textContent;
    const newCountText = countText.replace(/\d+/, notesLength);
    noteCountEl.textContent = newCountText;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const langSelect = document.getElementById("lang-select");

  let savedLang = localStorage.getItem("userLanguage") || navigator.language.split("-")[0];
  applyLanguage(savedLang);
  // 同步下拉框
  if (langSelect) langSelect.value = savedLang;

  // 用户切换语言
  if (langSelect) {
    langSelect.addEventListener("change", (e) => {
      const newLang = e.target.value; // "en" / "zh" / "ja" / "fr" ...
      applyLanguage(newLang);
      localStorage.setItem("userLanguage", newLang);
    });
  }
});
